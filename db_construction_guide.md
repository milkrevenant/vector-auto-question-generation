# 수능 국어 문제 JSON 데이터베이스 구축 완전 가이드

## 개요
이 문서는 한국 수능 국어 PDF 파일을 JSON 형식의 데이터베이스로 변환하는 작업의 표준 절차와 기술적 구현 방법을 포함합니다.

## 작업 원칙
1. **지문의 완전성이 최우선**: 부분 지문이나 요약은 데이터베이스를 무의미하게 만듭니다
2. **원본 PDF의 내용을 정확히 반영**: 지문, 문제, 선택지를 원문 그대로 입력
3. **관련 문제들은 동일한 지문 공유**: 35-37번처럼 연결된 문제들은 같은 지문 사용

## 필수 도구
- `pdfplumber` 또는 `PyPDF2`: PDF 텍스트 추출
- `re`: 정규표현식으로 패턴 매칭
- `json`: JSON 파일 생성

## 작업 프로세스

### 1단계: PDF 파일 구조 파악 및 분할

#### PDF 분할
- **모든 수능/모의평가 PDF는 항상 분할하여 작업**
- 자동 분할 수행:
  ```bash
  python3 split_pdf_single_pages.py XX_XX.pdf
  ```
  - 자동으로 XX_XX_split 폴더 생성 및 1페이지씩 분할
  - 출력 형식: XX_XX_page01.pdf, XX_XX_page02.pdf...

#### 참조 방법
- 특정 문제 작업 시 해당 페이지 + 앞뒤 1페이지씩 총 3페이지 참조
- 예: 15페이지의 문제 → page14.pdf + page15.pdf + page16.pdf 함께 읽기
- 첫 페이지: 해당 페이지 + 뒤 2페이지
- 마지막 페이지: 앞 2페이지 + 해당 페이지

### 2단계: 지문 범위 식별 및 추출

#### 지문 찾기
```python
# [번호~번호] 패턴 찾기
patterns = [r'\[(\d+)[~～](\d+)\]', r'\[(\d+)～(\d+)\]']
```

#### 지문 추출 원칙
- 지문 시작 마커 이후부터 문제 시작 전까지
- 여러 페이지에 걸친 경우 연결
- (가), (나) 등 구분 유지
- **2단 레이아웃**: 좌우 컬럼 순서 확인

### 3단계: 문제 및 선택지 추출

#### 문제 추출
- 문제 번호: `숫자.` 패턴
- 문제 텍스트: 선택지 시작 전까지
- `<보기>`가 있으면 context_box로 분리

#### 선택지 추출
- ①②③④⑤ 패턴
- 여러 줄에 걸친 선택지 연결
- 정확히 5개 추출

### 4단계: JSON 구조 생성

#### 표준 JSON 형식
```json
{
  "id": "YY_MM_QQ",
  "source": "20XX학년도 대학수학능력시험/6월 모의평가/9월 모의평가",
  "year": 2022,
  "month": 11,
  "exam_type_code": 1,
  "subject_code": "03",
  "type": "독서/문학/화법/작문/언어/매체",
  "passage": "전체 지문 텍스트",
  "context_box": "<보기> 내용 (있는 경우)",
  "question": "문제 텍스트",
  "options": [
    {"number": 1, "text": "선택지 1"},
    {"number": 2, "text": "선택지 2"},
    {"number": 3, "text": "선택지 3"},
    {"number": 4, "text": "선택지 4"},
    {"number": 5, "text": "선택지 5"}
  ],
  "answer_rate": 0,
  "difficulty": ""
}
```

#### 메타데이터 코드 체계

**시험 유형 코드 (exam_type_code)**
- 1: 대학수학능력시험 (11월)
- 2: 모의평가 (6월, 9월)

**과목 유형 코드 (subject_code)**
- 단일 유형:
  - "01": 화법
  - "02": 작문
  - "03": 독서
  - "04": 문학
  - "05": 언어 (문법)
  - "06": 매체
- 복합 유형:
  - "12": 화법과 작문
  - "56": 언어와 매체

**연도 변환 규칙**
- 대학수학능력시험 (11월): 학년도 - 1 = 시행 연도
- 6월 모의평가: 학년도 = 시행 연도
- 9월 모의평가: 학년도 = 시행 연도

예시:
- 2025학년도 대학수학능력시험 → year: 2024, month: 11
- 2025학년도 6월 모의평가 → year: 2025, month: 6
- 2025학년도 9월 모의평가 → year: 2025, month: 9

### 5단계: 구현 예시

```python
def extract_questions(start_num, end_num, pdf_dir="pdforg/25_11_split", output_dir="db"):
    # 1. 지문 범위 찾기
    passage_range = find_passage_range(start_num, end_num)
    
    # 2. 지문 추출
    passage_text = extract_passage(passage_range)
    
    # 3. 각 문제별로
    for q_num in range(start_num, end_num + 1):
        # 문제와 선택지 추출
        question_data = extract_question(q_num)
        
        # JSON 생성
        json_data = create_json(q_num, passage_text, question_data)
        
        # 파일 저장
        save_json(json_data, f"25_11_{q_num:02d}.json")
```

### 6단계: 검증 및 품질 관리

#### 지문 완전성 검증
1. 모든 _1.json 파일들의 passage 필드 확인
2. 빈 지문이나 부분 지문 발견 시 목록 작성
3. PDF에서 완전한 지문 찾아서 추가

#### 관련 문제 그룹 처리
- 동일 지문을 공유하는 문제들 파악 (예: 35-37, 38-42, 43-45)
- 각 그룹의 첫 번째 문제에서 지문 확인
- 같은 그룹의 모든 문제에 동일한 완전한 지문 적용

#### 특수 케이스 처리
- **화법**: 발표문, 대화문 등 화자 표시 정확히 포함
- **작문**: (가), (나) 등 자료 구분 명확히 표시
- **매체**: 화면 구성, 댓글, 링크 등 매체 특성 반영
- **보기 자료**: context_box에 정확히 기록

## 검증 체크리스트
- [ ] 모든 문제 파일이 생성되었는가?
- [ ] 모든 지문이 완전한가? (첫 문장부터 마지막 문장까지)
- [ ] 관련 문제들이 동일한 지문을 공유하는가?
- [ ] 문제와 선택지가 정확히 입력되었는가?
- [ ] 파일명 형식이 정확한가? (예: 23_11_35.json)
- [ ] 메타데이터가 정확히 입력되었는가? (year, month, exam_type_code, subject_code)
- [ ] 선택지가 정확히 5개인가?
- [ ] JSON 형식이 유효한가?

## 주의사항
1. **절대 지문을 요약하거나 생략하지 않음**
2. **PDF에서 찾을 수 없는 내용은 임의로 작성하지 않음**
3. **특수문자, 띄어쓰기, 줄바꿈 등 원문 형식 유지**
4. **PDF는 무조건 분할 사용**: 토큰 제한 방지를 위해 항상 분할된 PDF로 작업
5. **페이지 경계**: 문제나 지문이 페이지를 넘어갈 수 있음
6. **선택지 연결**: 긴 선택지는 여러 줄에 걸쳐 있을 수 있음

## 작업 명령 예시
```bash
# 1. PDF 분할
python3 split_pdf_single_pages.py 25_11.pdf

# 2. JSON 생성 작업 예시
"25_11_split 폴더의 분할된 PDF들을 사용해서 1번부터 10번까지 JSON 파일 생성해줘"
"40번 문제는 15페이지에 있으니 page14.pdf, page15.pdf, page16.pdf를 참조해서 작업해줘"

# 3. 검증 작업
"25_11_01.json부터 25_11_10.json까지 지문이 완전한지 점검해줘"
"해당 문제 페이지와 앞뒤 1페이지씩 참조해서 누락된 지문을 추가해줘"

# 4. 메타데이터 추가
"모든 JSON 파일에 메타데이터(year, month, exam_type_code, subject_code) 추가해줘"
```

## 별도 관리 파일
다음 매핑 정보를 별도 파일로 관리하는 것을 권장:
```json
// code_mapping.json
{
  "exam_types": {
    "1": "대학수학능력시험",
    "2": "모의평가"
  },
  "subject_types": {
    "01": "화법",
    "02": "작문",
    "03": "독서",
    "04": "문학",
    "05": "언어",
    "06": "매체",
    "12": "화법과 작문",
    "56": "언어와 매체"
  }
}
```

이 지침을 따라 작업하면 완전하고 의미있는 수능 국어 문제 데이터베이스를 구축할 수 있습니다.